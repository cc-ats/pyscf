#INFO: **** input file is /home/yangjunjie/pyscf/examples/2-benchmark/bz.py ****
#!/usr/bin/env python
import os
import time
import re
import numpy
from pyscf import lib
from pyscf import gto, scf, dft, mcscf, mp, cc, lo

def sort_mo(casscf, idx, mo_coeff):
    mol = casscf.mol
    corth = lo.orth.orth_ao(mol)
    casorb = corth[:,idx]

    nmo = mo_coeff.shape[1]
    ncore = casscf.ncore
    ncas = casscf.ncas
    nelecas = casscf.nelecas
    assert(ncas == casorb.shape[1])

    mo1 = reduce(numpy.dot, (casorb.T, casscf._scf.get_ovlp(), mo_coeff))
    sdiag = numpy.einsum('pi,pi->i', mo1, mo1)

    nocc = ncore + nelecas[0]
    casidx = numpy.hstack((numpy.argsort(sdiag[:nocc])[ncore:],
                           nocc+numpy.argsort(-sdiag[nocc:])[:ncas-nelecas[0]]))
    notcas = [i for i in range(nmo) if i not in casidx]
    mo = numpy.hstack((mo_coeff[:,notcas[:ncore]],
                       mo_coeff[:,casidx],
                       mo_coeff[:,notcas[ncore:]]))
    return mo

mol = gto.Mole()
mol.verbose = 5
mol.max_memory = 16000
log = lib.logger.Logger(mol.stdout, 5)
with open('/proc/cpuinfo') as f:
    for line in f:
        if 'model name' in line:
            log.note(line[:-1])
            break
with open('/proc/meminfo') as f:
    log.note(f.readline()[:-1])
log.note('OMP_NUM_THREADS=%s\n', os.environ.get('OMP_NUM_THREADS', None))

#for bas in ('3-21g', '6-31g*', 'cc-pVTZ', 'ANO-Roos-TZ'):
for bas in ('ANO-Roos-TZ',):
    mol.atom = '''
c   1.217739890298750 -0.703062453466927  0.000000000000000
h   2.172991468538160 -1.254577209307266  0.000000000000000
c   1.217739890298750  0.703062453466927  0.000000000000000
h   2.172991468538160  1.254577209307266  0.000000000000000
c   0.000000000000000  1.406124906933854  0.000000000000000
h   0.000000000000000  2.509154418614532  0.000000000000000
c  -1.217739890298750  0.703062453466927  0.000000000000000
h  -2.172991468538160  1.254577209307266  0.000000000000000
c  -1.217739890298750 -0.703062453466927  0.000000000000000
h  -2.172991468538160 -1.254577209307266  0.000000000000000
c   0.000000000000000 -1.406124906933854  0.000000000000000
h   0.000000000000000 -2.509154418614532  0.000000000000000
'''
    mol.basis = bas
    mol.output = 'bz-%s.out' %bas
    mol.build()
    cpu0 = time.clock(), time.time()

    mf = scf.RHF(mol)
    mf.kernel()
    cpu0 = log.timer('C6H6 %s RHF'%bas, *cpu0)

#    mymp2 = mp.MP2(mf)
#    mymp2.kernel()
#    cpu0 = log.timer('C6H6 %s MP2'%bas, *cpu0)
#
#    mymc = mcscf.CASSCF(mf, 6, 6)
#    idx = mol.search_ao_label('C 2pz')
#    mo = sort_mo(mymc, idx, mf.mo_coeff)
#    mymc.kernel(mo)
#    cpu0 = log.timer('C6H6 %s CASSCF'%bas, *cpu0)

    mycc = cc.CCSD(mf)
    mycc.kernel()
    cpu0 = log.timer('C6H6 %s CCSD'%bas, *cpu0)

    mf = dft.RKS(mol)
    mf.xc = 'b3lyp'
    mf.kernel()
    cpu0 = log.timer('C6H6 %s B3LYP'%bas, *cpu0)

    mf = scf.density_fit(mf)
    mf.kernel()
    cpu0 = log.timer('C6H6 %s density-fit RHF'%bas, *cpu0)

#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='c193.oscer.ou.edu', release='3.10.0-693.11.6.el7.x86_64', version='#1 SMP Thu Jan 4 01:06:37 UTC 2018', machine='x86_64', processor='x86_64')  Threads 1
Python 3.7.4 (default, Aug 13 2019, 20:35:49) 
[GCC 7.3.0]
numpy 1.17.2  scipy 1.3.1
Date: Fri Jan 10 11:40:41 2020
PySCF version 1.6.5
PySCF path  /home/yangjunjie/work/pyscf/pyscf
GIT ORIG_HEAD ac7fac1ea834546382ab95daca9ac425b11a6adb
GIT HEAD      ref: refs/heads/dev
GIT dev branch  4013c78d3eedd162c3be972d507498597f3d32bd

[ENV] PYSCF_WORK /home/yangjunjie/work/pyscf/pyscf/lib/compile-oscer.sh
[ENV] PYSCF_HOME /home/yangjunjie/pyscf/pyscf/lib/compile-oscer.sh
[CONFIG] conf_file None
[INPUT] verbose = 5
[INPUT] max_memory = 16000 
[INPUT] num. atoms = 12
[INPUT] num. electrons = 42
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT]  1 C      1.217739890299  -0.703062453467   0.000000000000 AA    2.301194883623  -1.328595485517   0.000000000000 Bohr
[INPUT]  2 H      2.172991468538  -1.254577209307   0.000000000000 AA    4.106358746554  -2.370807327712   0.000000000000 Bohr
[INPUT]  3 C      1.217739890299   0.703062453467   0.000000000000 AA    2.301194883623   1.328595485517   0.000000000000 Bohr
[INPUT]  4 H      2.172991468538   1.254577209307   0.000000000000 AA    4.106358746554   2.370807327712   0.000000000000 Bohr
[INPUT]  5 C      0.000000000000   1.406124906934   0.000000000000 AA    0.000000000000   2.657190971035   0.000000000000 Bohr
[INPUT]  6 H      0.000000000000   2.509154418615   0.000000000000 AA    0.000000000000   4.741614655424   0.000000000000 Bohr
[INPUT]  7 C     -1.217739890299   0.703062453467   0.000000000000 AA   -2.301194883623   1.328595485517   0.000000000000 Bohr
[INPUT]  8 H     -2.172991468538   1.254577209307   0.000000000000 AA   -4.106358746554   2.370807327712   0.000000000000 Bohr
[INPUT]  9 C     -1.217739890299  -0.703062453467   0.000000000000 AA   -2.301194883623  -1.328595485517   0.000000000000 Bohr
[INPUT] 10 H     -2.172991468538  -1.254577209307   0.000000000000 AA   -4.106358746554  -2.370807327712   0.000000000000 Bohr
[INPUT] 11 C      0.000000000000  -1.406124906934   0.000000000000 AA    0.000000000000  -2.657190971035   0.000000000000 Bohr
[INPUT] 12 H      0.000000000000  -2.509154418615   0.000000000000 AA    0.000000000000  -4.741614655424   0.000000000000 Bohr
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] H
[INPUT] 0    0    [8    /4   ]  188.61445         0.0009639 -0.0013119 0.0024224 -0.0115701
                                28.276596         0.007492 -0.0103451 0.0203382 -0.0837154
                                6.42483           0.0375954 -0.0504953 0.0896394 -0.4451663
                                1.815041          0.143395 -0.2073855 0.4422907 -1.146271
                                0.591063          0.3486363 -0.4350885 0.5757144 2.5031871
                                0.212149          0.4382974 -0.0247297 -0.980289 -1.5828493
                                0.079891          0.1651066 0.322526 -0.6721538 0.03096569
                                0.027962          0.0210229 0.7072754 1.1417685 0.30862864
[INPUT] 1    0    [4    /3   ]  2.305             0.1127902 -0.2108688 0.7599501
                                0.80675           0.4185075 -0.5943796 0.1646159
                                0.282362          0.4700077 0.0896889 -1.371014
                                0.098827          0.182626 0.8611634 1.0593155
[INPUT] 2    0    [3    /2   ]  1.819             0.2705134 -0.7938035
                                0.7276            0.5510125 -0.0914252
                                0.29104           0.3310866 0.8620033
[INPUT] C
[INPUT] 0    0    [14   /5   ]  50557.501         5.53e-05 -1.2e-05 1.19e-05 -1.56e-05 1.74e-05
                                7524.7856         0.0004343 -9.4e-05 9.27e-05 -0.000114 0.0001232
                                1694.3276         0.0023159 -0.0005028 0.0004989 -0.0006731 0.0007634
                                472.82279         0.0098729 -0.0021476 0.002118 -0.0025323 0.0027003
                                151.71075         0.0352195 -0.0077942 0.0077784 -0.0109003 0.012678
                                53.918746         0.1041938 -0.0237634 0.0236328 -0.0277807 0.0302866
                                20.659311         0.2412741 -0.0600235 0.0616306 -0.0958713 0.1201464
                                8.383976          0.3840174 -0.1153985 0.118968 -0.1247806 0.1242773
                                3.577015          0.3082371 -0.1539009 0.1880621 -0.393246 0.5530431
                                1.547118          0.0683055 -0.0145946 -0.0540304 0.6796004 -1.660497
                                0.613013          0.0007782 0.3895849 -0.9814137 1.197869 0.2197707
                                0.246068          0.0009905 0.5397291 -0.1096758 -1.897952 2.6568329
                                0.099087          -8.93e-05 0.188406 0.8847356 -0.0044614 -3.596556
                                0.03468           4.71e-05 0.0258575 0.2964983 1.0142148 1.8521129
[INPUT] 1    0    [9    /4   ]  83.333155         0.0012241 -0.0011444 0.0014669 -0.0037213
                                19.557611         0.0094389 -0.0089796 0.0144553 -0.0379844
                                6.080365          0.0417744 -0.0378456 0.0466373 -0.1698042
                                2.179317          0.131833 -0.1292708 0.2366537 -0.8114152
                                0.86515           0.2789119 -0.3784022 0.6088734 0.242173
                                0.361944          0.3668663 -0.2692137 -0.3917793 1.3030673
                                0.15474           0.2790591 0.2917542 -0.8700229 -1.200142
                                0.065429          0.1380481 0.5436698 0.4200505 -0.0905452
                                0.0229            0.034195 0.2628308 0.5799497 0.5698009
[INPUT] 2    0    [4    /3   ]  1.9               0.0987312 -0.1455013 0.5637683
                                0.665             0.4529661 -0.5076809 0.4312592
                                0.23275           0.4362457 -0.101563 -1.277998
                                0.081463          0.271925 0.9251922 0.8354205
[INPUT] 3    0    [3    /2   ]  1.25              0.311365 -0.504138
                                0.5               0.5159673 -0.4373719
                                0.2               0.3774231 1.0147246

nuclear repulsion = 201.574407105832
number of shells = 42
number of NR pGTOs = 702
number of NR cGTOs = 414
basis = ANO-Roos-TZ
ecp = {}
CPU time:         0.62


******** <class 'pyscf.scf.hf.RHF'> ********
method = RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /tmp/tmp00hfyjcu
max_memory 16000 MB (current use 66 MB)
Set gradient conv threshold to 3.16228e-05
cond(S) = 11475461.910431199
